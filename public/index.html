<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…Ø¯Ù†ÙŠØ©</title>

  <!-- Bootstrap 5 RTL CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet"/>
  
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
  
  <!-- Supabase Config -->
  <script src="supabase-config.js"></script>
  
  <!-- Reports Storage -->
  <script src="reports-storage.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    /* Fixed color variables without dark mode */
    :root{
      --background:#ffffff; --foreground:#0f172a; --card:#f8fafc; --card-foreground:#0f172a;
      --primary:#7c3aed; --primary-foreground:#ffffff; --secondary:#f1f5f9; --secondary-foreground:#0f172a;
      --muted:#f1f5f9; --muted-foreground:#64748b; --accent:#f1f5f9; --border:#e2e8f0;
      --input:#f8fafc; --ring:#7c3aed; --blur-overlay: rgba(255,255,255,.35);
    }

    /* Ø®Ù„ÙÙŠØ© Ø¨ØµÙˆØ±Ø© + Ø¨Ù„ÙˆØ± */
    .body-bg-blur::before{
      content:""; position:fixed; inset:0; z-index:-1;
      background:
        linear-gradient(0deg, rgba(255,255,255,.35), rgba(255,255,255,.35)),
        url("image.png") center/cover no-repeat;  /* â† Ø¹Ø¯Ù‘Ù„ Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© Ù„Ùˆ Ø£Ø±Ø¯Øª */
      filter: blur(18px);
      transform: scale(1.08);
    }

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'DM Sans','Space Grotesk',-apple-system,BlinkMacSystemFont,sans-serif;
      background:var(--background); color:var(--foreground); line-height:1.6;
    }
    .container{max-width:1400px; margin:0 auto; padding:0 24px}

    section{padding:48px 0}
    .section-title{font-family:'Space Grotesk',sans-serif; font-weight:700; margin-bottom:12px}
    .section-sub{color:var(--muted-foreground); margin-bottom:24px}
    :target::before{ content:""; display:block; height:80px; margin-top:-80px }

    /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ùˆ Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ø§Ù…Ø© */
    .stats{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:20px; margin:16px 0 32px}
    .stat-card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:24px; text-align:center; position:relative; overflow:hidden; transition:.3s}
    .stat-card::before{content:''; position:absolute; top:0; left:0; right:0; height:3px; background:linear-gradient(90deg,var(--primary),#a855f7)}
    .stat-card:hover{transform:translateY(-4px); box-shadow:0 8px 32px rgba(139,92,246,.15); border-color:var(--primary)}
    .stat-number{font-size:42px; font-weight:700; color:var(--primary); margin-bottom:8px; font-family:'Space Grotesk',sans-serif}
    .stat-label{color:var(--muted-foreground); font-size:13px; letter-spacing:.5px}

    /* Admin Messages Ticker */
    .admin-ticker-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-bottom: 2px solid var(--primary);
      overflow: hidden;
      position: relative;
      z-index: 10;
    }
    
    .admin-ticker {
      height: 40px;
      display: flex;
      align-items: center;
      white-space: nowrap;
      overflow: hidden;
    }
    
    .ticker-content {
      display: flex;
      animation: scroll-ticker 30s linear infinite;
      gap: 100px;
    }
    
    .ticker-item {
      color: white;
      font-weight: 500;
      font-size: 14px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      display: inline-block;
      white-space: nowrap;
    }
    
    @keyframes scroll-ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    
    /* Pause animation on hover */
    .admin-ticker:hover .ticker-content {
      animation-play-state: paused;
    }

    /* Footer Styles */
    .footer-section {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      padding: 60px 0 20px;
      margin-top: 80px;
    }
    
    .footer-content {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 40px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 992px) {
      .footer-content {
        grid-template-columns: 1fr;
        gap: 30px;
        text-align: center;
      }
    }
    
    .footer-info h4 {
      color: #f8fafc;
      font-size: 24px;
      margin-bottom: 16px;
      font-family: 'Space Grotesk', sans-serif;
    }
    
    .footer-info p {
      color: #cbd5e1;
      line-height: 1.6;
      font-size: 16px;
    }
    
    .footer-social h5,
    .footer-contact h5 {
      color: #f8fafc;
      font-size: 18px;
      margin-bottom: 20px;
      font-weight: 600;
    }
    
    .social-links {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    @media (max-width: 992px) {
      .social-links {
        justify-content: center;
      }
    }
    
    .social-link {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: 18px;
    }
    
    .social-link.facebook { background: #1877f2; }
    .social-link.twitter { background: #1da1f2; }
    .social-link.instagram { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
    .social-link.linkedin { background: #0077b5; }
    .social-link.youtube { background: #ff0000; }
    
    .social-link:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    
    .contact-info p {
      color: #cbd5e1;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    @media (max-width: 992px) {
      .contact-info p {
        justify-content: center;
      }
    }
    
    .contact-info i {
      color: var(--primary);
      width: 20px;
    }
    
    .footer-bottom {
      border-top: 1px solid #475569;
      padding-top: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    @media (max-width: 768px) {
      .footer-bottom {
        flex-direction: column;
        text-align: center;
      }
    }
    
    .copyright p {
      color: #94a3b8;
      margin: 0;
      font-size: 14px;
    }
    
    .footer-links {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
    }
    
    @media (max-width: 768px) {
      .footer-links {
        justify-content: center;
      }
    }
    
    .footer-links a {
      color: #cbd5e1;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.3s ease;
    }
    
    .footer-links a:hover {
      color: var(--primary);
    }

    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:24px; margin-bottom:24px; box-shadow:0 4px 16px rgba(0,0,0,.08); transition:.3s}
    .card:hover{box-shadow:0 8px 32px rgba(139,92,246,.12)}
    .btn.primary{background:linear-gradient(135deg,var(--primary),#a855f7); color:#fff; border:none}
    .btn.primary:hover{opacity:.95; transform:translateY(-1px)}
    .admin-only{display:none}
    .admin-mode .admin-only{display:block}

    .two-col{display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:start}
    @media (max-width:992px){ .two-col{grid-template-columns:1fr} }

    /* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª */
    #reportForm{display:grid; gap:16px}
    #reportForm .field{display:flex; flex-direction:column; gap:8px}
    #reportForm label{font-weight:600; color:var(--foreground); margin:0}
    #reportForm input,#reportForm textarea,#reportForm select{width:100%}
    #reportForm textarea{min-height:120px; resize:vertical}
    #reportForm .row-2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width: 768px){ #reportForm .row-2{grid-template-columns:1fr} }

    /* Ø±Ø§ÙØ¹ Ø§Ù„ØµÙˆØ± */
    .uploader{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    @media (max-width: 768px){ .uploader{grid-template-columns:1fr} }
    .upload-box{border:2px dashed var(--border); border-radius:12px; padding:20px; text-align:center; background:var(--muted); transition:.3s}
    .upload-box:hover{border-color:var(--primary); background:var(--accent)}
    .upload-box input[type="file"]{display:none}
    .upload-box label{cursor:pointer; color:var(--primary); font-weight:600; display:block; padding:12px; border-radius:8px}
    .preview{margin-top:10px}
    .preview img{max-width:100%; height:auto; border-radius:8px}

    /* Ø´Ø¨ÙƒØ© Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Ù…Ø«Ù„ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø©) */
    .gallery-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:28px;
    }
    @media (max-width: 992px){
      .gallery-grid{ grid-template-columns:1fr }
    }
    @media (min-width: 1400px){
      .gallery-grid{ grid-template-columns: repeat(3, minmax(0, 1fr)) }
    }
    .gallery-item{
      position:relative; overflow:hidden; border-radius:16px;
      background:var(--card); box-shadow:0 10px 24px rgba(0,0,0,.12);
      transition:transform .25s ease, box-shadow .25s ease;
    }
    .gallery-item:hover{ transform:translateY(-4px); box-shadow:0 14px 32px rgba(0,0,0,.18) }
    .gallery-img{ width:100%; height:280px; object-fit:cover; display:block }
    .gallery-actions{
      position:absolute; top:10px; left:10px; display:none; gap:8px;
    }
    .admin-mode .gallery-actions{ display:flex }
  </style>
</head>

<body class="body-bg-blur">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© Ø®Ù†Ø´Ù„Ø©</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="#reports">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</a></li>
          <li class="nav-item"><a class="nav-link" href="#photos">Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</a></li>
          <li class="nav-item"><a class="nav-link" href="#support">Ø§Ù„Ø¯Ø¹Ù…</a></li>
        </ul>

        <div class="d-flex">
          <!-- Ø£Ø²Ø±Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
          <a id="loginBtn" href="login.html" class="btn btn-sm btn-outline-primary me-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
          <a id="registerBtn" href="register.html" class="btn btn-sm btn-outline-success me-2">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
         
          <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
          <button id="logoutBtn" class="btn btn-sm btn-danger" type="button" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Admin Messages Ticker -->
  <div class="admin-ticker-container">
    <div class="admin-ticker">
      <div class="ticker-content" id="adminTicker">
        <span class="ticker-item">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…Ø¯Ù†ÙŠØ©</span>
        <span class="ticker-item">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº</span>
        <span class="ticker-item">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±</span>
      </div>
    </div>
  </div>

  <main>

    <!-- SECTION: Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª -->
    <section id="reports">
      <div class="container">
        <h2 class="section-title">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h2>
        <p class="section-sub">Ø£Ø±Ø³Ù„ Ø¨Ù„Ø§ØºÙ‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ ÙˆØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„Ø©.</p>

        <div class="stats">
          <div class="stat-card"><div class="stat-number" id="total-reports">0</div><div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</div></div>
          <div class="stat-card"><div class="stat-number" id="new-reports">0</div><div class="stat-label">Ø¬Ø¯ÙŠØ¯Ø©</div></div>
          <div class="stat-card"><div class="stat-number" id="in-progress-reports">0</div><div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div></div>
          <div class="stat-card"><div class="stat-number" id="resolved-reports">0</div><div class="stat-label">ØªÙ… Ø§Ù„Ø­Ù„</div></div>
        </div>

        <div class="two-col">
          <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ù„Ø§Øº -->
          <div class="form-section">
            <div class="card">
              <h3 class="mb-3">Ø¥Ø¶Ø§ÙØ© Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯</h3>

              <form id="reportForm">
                <div class="field">
                  <label for="title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                  <input class="form-control" type="text" id="title" required placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ù„Ø§Øº">
                </div>

                <div class="field">
                  <label for="description">Ø§Ù„ÙˆØµÙ</label>
                  <textarea class="form-control" id="description" maxlength="500" required placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ø´ÙƒÙ„Ø©"></textarea>
                </div>

                <div class="field">
                  <label for="district">Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ</label>
                  <input class="form-control" type="text" id="district" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
                </div>

                <div class="row-2">
                  <div class="field">
                    <label for="commune">Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</label>
                    <select class="form-select" id="commune" required>
                      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</option>
                      <option>Ø¹ÙŠÙ† Ø§Ù„Ø·ÙˆÙŠÙ„Ø©</option><option>Ø¨Ø§Ø¨Ø§Ø±</option><option>Ø¨ØºØ§ÙŠ</option><option>Ø¨ÙˆØ­Ù…Ø§Ù…Ø©</option><option>Ø´Ø´Ø§Ø±</option><option>Ø´Ù„ÙŠØ©</option>
                      <option>Ø¬Ù„Ø§Ù„</option><option>Ø§Ù„Ø­Ø§Ù…Ø©</option><option>Ø§Ù„Ù…Ø­Ù…Ù„</option><option>Ø§Ù„ÙˆÙ„Ø¬Ø©</option><option>Ø§Ù†Ø³ÙŠØºØ©</option><option>Ù‚Ø§ÙŠØ³</option>
                      <option>Ø®Ù†Ø´Ù„Ø©</option><option>Ø®ÙŠØ±Ø§Ù†</option><option>Ù„Ù…ØµØ§Ø±Ø©</option><option>Ù…ØªÙˆØ³Ø©</option><option>Ø£ÙˆÙ„Ø§Ø¯ Ø±Ø´Ø§Ø´</option><option>Ø§Ù„Ø±Ù…ÙŠÙ„Ø©</option>
                      <option>Ø·Ø§Ù…Ø²Ø©</option><option>ØªØ§ÙˆØ²ÙŠØ§Ù†Øª</option><option>ÙŠØ§Ø¨ÙˆØ³</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="category">Ø§Ù„ÙØ¦Ø©</label>
                    <select class="form-select" id="category">
                      <option value="lighting">ğŸ’¡ Ø¥Ù†Ø§Ø±Ø©</option>
                      <option value="pothole">ğŸ•³ï¸ Ø­ÙØ±</option>
                      <option value="waste">ğŸ—‘ï¸ Ù†ÙØ§ÙŠØ§Øª</option>
                      <option value="water">ğŸ’§ Ù…ÙŠØ§Ù‡</option>
                      <option value="works">ğŸš§ Ø£Ø´ØºØ§Ù„</option>
                      <option value="other">ğŸ“‹ Ø£Ø®Ø±Ù‰</option>
                    </select>
                  </div>
                </div>

                <div class="row-2 admin-only">
                  <div class="field">
                    <label for="priority">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                    <select class="form-select" id="priority">
                      <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                      <option value="medium" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
                      <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                      <option value="urgent">Ø¹Ø§Ø¬Ù„Ø©</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="internalNote">Ù…Ù„Ø§Ø­Ø¸Ø© Ø¯Ø§Ø®Ù„ÙŠØ© (Ù„Ø§ ØªØ¸Ù‡Ø± Ù„Ù„Ø¹Ø§Ù…Ø©)</label>
                    <textarea class="form-control" id="internalNote" placeholder="ØªÙØ§ØµÙŠÙ„ ØªÙ‚Ù†ÙŠØ©ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…ØµÙ„Ø­Ø© ÙƒØ°Ø§..."></textarea>
                  </div>
                </div>

                <div class="uploader my-2">
                  <div class="upload-box">
                    <label for="before">ğŸ“· ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø´ØºØ§Ù„</label>
                    <input type="file" id="before" accept="image/*">
                    <div class="preview" id="prev-before"></div>
                  </div>
                  <div class="upload-box">
                    <label for="after">ğŸ“· ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø´ØºØ§Ù„</label>
                    <input type="file" id="after" accept="image/*">
                    <div class="preview" id="prev-after"></div>
                  </div>
                </div>

                <button class="btn primary" type="submit">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº</button>
              </form>
            </div>
          </div>

          <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª (Ø¹ÙŠÙ†Ø§Øª) -->
          <div class="gallery-section">
            <div class="card">
              <h3 class="mb-3">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª - Les Rapports</h3>

              <div class="row g-2 mb-3">
                <div class="col-12 col-md-4">
                  <select id="filterCategory" class="form-select">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                    <option value="lighting">ğŸ’¡ Ø¥Ù†Ø§Ø±Ø©</option>
                    <option value="pothole">ğŸ•³ï¸ Ø­ÙØ±</option>
                    <option value="waste">ğŸ—‘ï¸ Ù†ÙØ§ÙŠØ§Øª</option>
                    <option value="water">ğŸ’§ Ù…ÙŠØ§Ù‡</option>
                    <option value="works">ğŸš§ Ø£Ø´ØºØ§Ù„</option>
                    <option value="other">ğŸ“‹ Ø£Ø®Ø±Ù‰</option>
                  </select>
                </div>
                <div class="col-12 col-md-4">
                  <select id="filterStatus" class="form-select">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="new">Ø¬Ø¯ÙŠØ¯Ø©</option>
                    <option value="in-progress">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                    <option value="resolved">ØªÙ… Ø§Ù„Ø­Ù„</option>
                  </select>
                </div>
                <div class="col-12 col-md-4">
                  <select id="filterCommune" class="form-select">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ§Øª</option>
                    <option>Ø®Ù†Ø´Ù„Ø©</option><option>Ø¨Ø§Ø¨Ø§Ø±</option><option>Ø¨ØºØ§ÙŠ</option>
                  </select>
                </div>
              </div>

              <div id="reportsGallery" style="display:grid;gap:16px;max-height:600px;overflow-y:auto;">
                <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹ÙŠÙ†Ø© -->
                <div class="report-card" style="background:var(--muted);border:1px solid var(--border);border-radius:12px;padding:16px;">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                      <h4 class="mb-1" style="font-size:16px;">Ø¥ØµÙ„Ø§Ø­ Ø­ÙØ±Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</h4>
                      <div style="display:flex;gap:8px;font-size:12px;color:var(--muted-foreground);">
                        <span>ğŸ•³ï¸</span><span>Ø§Ù„Ø­ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span><span>â€¢</span><span>Ø¨Ù„Ø¯ÙŠØ© Ø§Ù„Ø­Ø§Ù…Ø©</span>
                      </div>
                    </div>
                    <span class="badge" style="background:#ef4444;">Ø¹Ø§Ù„ÙŠØ©</span>
                  </div>
                  <p class="mb-2" style="color:var(--muted-foreground);">Ø­ÙØ±Ø© ÙƒØ¨ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØªØ³Ø¨Ø¨ Ø®Ø·Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙˆØ± ÙˆÙŠØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­ Ø¹Ø§Ø¬Ù„</p>
                  <div class="d-flex justify-content-between" style="font-size:12px;">
                    <span style="color:var(--muted-foreground);">Ø§Ù„ØªØ§Ø±ÙŠØ®: 15-01-2024</span>
                    <span class="badge" style="background:var(--primary);">Ø¬Ø¯ÙŠØ¯Ø©</span>
                  </div>
                </div>

                <div class="report-card" style="background:var(--muted);border:1px solid var(--border);border-radius:12px;padding:16px;">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                      <h4 class="mb-1" style="font-size:16px;">Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„Ø¥Ù†Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h4>
                      <div style="display:flex;gap:8px;font-size:12px;color:var(--muted-foreground);">
                        <span>ğŸ’¡</span><span>Ø­ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span><span>â€¢</span><span>Ø¨Ù„Ø¯ÙŠØ© Ø¨Ø§Ø¨Ø§Ø±</span>
                      </div>
                    </div>
                    <span class="badge" style="background:#f59e0b;">Ù…ØªÙˆØ³Ø·Ø©</span>
                  </div>
                  <p class="mb-2" style="color:var(--muted-foreground);">Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ù†Ø§Ø±Ø© Ù„Ø§ ÙŠØ¹Ù…Ù„ Ù…Ù†Ø° Ø£Ø³Ø¨ÙˆØ¹ Ù…Ù…Ø§ ÙŠØ³Ø¨Ø¨ Ø¸Ù„Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</p>
                  <div class="d-flex justify-content-between" style="font-size:12px;">
                    <span style="color:var(--muted-foreground);">Ø§Ù„ØªØ§Ø±ÙŠØ®: 14-01-2024</span>
                    <span class="badge" style="background:#f59e0b;">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                  </div>
                </div>

              </div> <!-- /reportsGallery -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SECTION: Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± -->
    <section id="photos">
      <div class="container">
        <h2 class="section-title">Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</h2>
        <p class="section-sub">Ø§Ø±ÙØ¹ ØµÙˆØ± Ù‚Ø¨Ù„/Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø´ØºØ§Ù„ ÙˆØ§Ø³ØªØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶.</p>

        <!-- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±: ÙŠØ¸Ù‡Ø± Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø· -->
        <div class="card admin-only">
          <h3 class="mb-3">Ø±ÙØ¹ ØµÙˆØ±</h3>
          <div class="uploader">
            <div class="upload-box" id="dropZone">
              <strong>Ø£ÙÙ„Øª Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§</strong>
              <div class="text-muted" style="font-size:13px;">ÙŠØ¯Ø¹Ù… Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª</div>
            </div>
            <div class="upload-box">
              <label>ğŸ“· Ø§Ø®ØªØ± ØµÙˆØ±Ù‹Ø§
                <input type="file" id="imageUpload" accept="image/*" multiple>
              </label>
              <div class="text-muted" style="font-size:13px;">ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± ÙˆØ¥ÙÙ„Ø§ØªÙ‡Ø§ Ù‡Ù†Ø§ Ø£ÙŠØ¶Ù‹Ø§.</div>
            </div>
          </div>
        </div>

        <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ø±Ø¶ -->
        <div class="card">
          <div id="photoGrid" class="gallery-grid">
            <!-- ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‡Ù†Ø§ -->
          </div>
        </div>
      </div>
    </section>

    <!-- SECTION: Ø§Ù„Ø¯Ø¹Ù… -->
    <section id="support">
      <div class="container">
        <h2 class="section-title">Ø§Ù„Ø¯Ø¹Ù…</h2>
        <p class="section-sub">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø£Ùˆ Ø§Ø·Ù‘Ù„Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©.</p>

        <div class="row g-3">
          <div class="col-12 col-lg-6">
            <div class="card">
              <h3>Ø§ØªØµÙ„ Ø¨Ù†Ø§</h3>
              <form id="supportForm">
                <div class="mb-2">
                  <label for="sName" class="form-label">Ø§Ù„Ø§Ø³Ù…</label>
                  <input class="form-control" type="text" id="sName" required>
                </div>
                <div class="mb-2">
                  <label for="sEmail" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                  <input class="form-control" type="email" id="sEmail" required>
                </div>
                <div class="mb-2">
                  <label for="sMsg" class="form-label">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                  <textarea class="form-control" id="sMsg" rows="4" required></textarea>
                </div>
                <button class="btn primary" type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
              </form>
            </div>
          </div>

          <div class="col-12 col-lg-6">
            <div class="card">
              <h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h3>
              <div class="accordion" id="faq">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="q1">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a1">
                      ÙƒÙŠÙ Ø£Ø±Ø³Ù„ Ø¨Ù„Ø§ØºÙ‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ØŸ
                    </button>
                  </h2>
                  <div id="a1" class="accordion-collapse collapse" data-bs-parent="#faq">
                    <div class="accordion-body">Ù…Ù† Ù‚Ø³Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§ØªØŒ Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø«Ù… Ø§Ø¶ØºØ· "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº".</div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="q2">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a2">
                      ÙƒÙŠÙ Ø£ØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù„Ø§ØºØŸ
                    </button>
                  </h2>
                  <div id="a2" class="accordion-collapse collapse" data-bs-parent="#faq">
                    <div class="accordion-body">Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¬Ø§Ù†Ø¨ ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù„Ø§Øº Ø¶Ù…Ù† Ù‚Ø³Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª.</div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="q3">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a3">
                      Ù‡Ù„ ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø©ØŸ
                    </button>
                  </h2>
                  <div id="a3" class="accordion-collapse collapse" data-bs-parent="#faq">
                    <div class="accordion-body">Ù†Ø¹Ù…ØŒ Ù…Ù† Ù‚Ø³Ù… "Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±" ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø© ØµÙˆØ± Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div> <!-- /row -->
      </div>
    </section>

  </main>

  <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± -->
  <div id="imageModal" class="modal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.8);">
    <div class="modal-content" style="position:relative;margin:5% auto;padding:20px;width:90%;max-width:800px;background:white;border-radius:12px;">
      <span class="close" style="position:absolute;top:10px;right:20px;font-size:28px;font-weight:bold;cursor:pointer;">&times;</span>
      <div id="modalContent">
        <h3 id="modalTitle" style="margin-bottom:20px;"></h3>
        <div id="modalImages" style="display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));">
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Section -->
  <footer class="footer-section">
    <div class="container">
      <div class="footer-content">
        <div class="footer-info">
          <h4>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h4>
          <p>Ù…Ù†ØµØ© Ù…ØªØ·ÙˆØ±Ø© Ù„Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© ÙˆØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª</p>
        </div>
        
        <div class="footer-social">
          <h5>ØªØ§Ø¨Ø¹ÙˆÙ†Ø§ Ø¹Ù„Ù‰</h5>
          <div class="social-links">
            <a href="#" class="social-link facebook" title="Facebook">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="social-link twitter" title="Twitter">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="social-link instagram" title="Instagram">
              <i class="fab fa-instagram"></i>
            </a>
            <a href="#" class="social-link linkedin" title="LinkedIn">
              <i class="fab fa-linkedin-in"></i>
            </a>
            <a href="#" class="social-link youtube" title="YouTube">
              <i class="fab fa-youtube"></i>
            </a>
          </div>
        </div>
        
        <div class="footer-contact">
          <h5>Ø§ØªØµÙ„ Ø¨Ù†Ø§</h5>
          <div class="contact-info">
            <p><i class="fas fa-phone"></i> +213672413137</p>
            <p><i class="fas fa-envelope"></i> medislemhafidi@gmail.com</p>
            <p><i class="fas fa-map-marker-alt"></i> Ø®Ù†Ø´Ù„Ø© , Ø®Ù†Ø´Ù„Ø© - Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</p>
          </div>
        </div>
      </div>
      
      <div class="footer-bottom">
        <div class="copyright">
          <p>&copy; 2025 Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        </div>
        <div class="footer-links">
          <a href="#">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
          <a href="#">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a>
          <a href="#">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
  <script src="supabase-config.js"></script>

  <script>
    // ========= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© =========
    const ADMIN_PASS = 'admin123'; // â† ØºÙŠÙ‘Ø± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‡Ù†Ø§
    const GALLERY_KEY = 'galleryImages';
    const LOGIN_STATUS_KEY = 'loginStatus';

    // Check if user is authenticated, redirect to landing page if not
    function checkAuth() {
      const user = localStorage.getItem('user');
      if (!user) {
        window.location.href = 'landing.html';
        return false;
      }
      return true;
    }

    // Redirect non-authenticated users immediately
    if (!checkAuth()) {
      // This prevents the rest of the script from running if redirected
      throw new Error('Redirecting to landing page');
    }

    // Supabase initialization
     const SUPABASE_URL = window.supabaseConfig.url;
     const SUPABASE_KEY = window.supabaseConfig.key;
     
     // Initialize Supabase client
     const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
     
     // Use the initSupabase function from supabaseConfig
     function initSupabase() {
       return window.supabaseConfig.initSupabase();
     }

    // Theme function removed as dark mode has been removed

    function toggleAdmin(){
      const isAdmin = document.body.classList.contains('admin-mode');
      if(!isAdmin){
        const pass = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:');
        if(pass !== ADMIN_PASS){ alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); return; }
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        localStorage.setItem(LOGIN_STATUS_KEY, 'true');
        document.getElementById('logoutBtn').style.display = 'block';
      } else {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù†Ø¯ Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        localStorage.removeItem('adminMode');
        document.body.classList.remove('admin-mode');
        window.location.href = 'landing.html';
        logout();
        return;
      }
      document.body.classList.toggle('admin-mode');
      localStorage.setItem('adminMode', document.body.classList.contains('admin-mode'));
    }
    
    async function logout() {
      try {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Supabase
        const { error } = await supabaseClient.auth.signOut();
        if (error) throw error;
        
        // Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        localStorage.removeItem(LOGIN_STATUS_KEY);
        localStorage.removeItem('adminMode');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userName');
        localStorage.removeItem('userId');
        localStorage.removeItem('user'); // Remove user session data
        
        document.body.classList.remove('admin-mode');
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('registerBtn').style.display = 'block';
        
        alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        
        // Redirect to landing page after logout
        window.location.href = 'landing.html';
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error.message);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
      }
    }

    document.addEventListener('DOMContentLoaded', async ()=>{
      // ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­ÙÙˆØ¸
      if(localStorage.getItem('adminMode')==='true'){ document.body.classList.add('admin-mode'); }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      let isLoggedIn = false;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Supabase
      try {
        const { data: { user } } = await supabaseClient.auth.getUser();
        if (user) {
          isLoggedIn = true;
          localStorage.setItem(LOGIN_STATUS_KEY, 'true');
          localStorage.setItem('userEmail', user.email);
          localStorage.setItem('userId', user.id);
          
          // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          try {
            const { data: userData, error: userError } = await supabaseClient
              .from('profiles')
              .select('full_name')
              .eq('id', user.id)
              .single();
              
            if (!userError && userData && userData.full_name) {
              localStorage.setItem('userName', userData.full_name);
            }
          } catch (profileError) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', profileError);
          }
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† localStorage ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
      if (localStorage.getItem(LOGIN_STATUS_KEY) === 'true') {
        isLoggedIn = true;
      }
      
      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      if (isLoggedIn) {
        document.getElementById('logoutBtn').style.display = 'block';
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('registerBtn').style.display = 'none';
      } else {
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('registerBtn').style.display = 'block';
      }

      // ØªØ£Ø«ÙŠØ± hover Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
      document.querySelectorAll('.report-card').forEach(card=>{
        card.addEventListener('mouseenter',function(){ this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(139,92,246,.15)'; this.style.borderColor='var(--primary)'; });
        card.addEventListener('mouseleave',function(){ this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='var(--border)'; });
      });

      // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      renderGallery();
    });

    // ========= Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± (Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·) =========
    const imageUpload = document.getElementById('imageUpload');
    const dropZone = document.getElementById('dropZone');

    function handleFiles(files){
      Array.from(files).forEach(file=>{
        if(!file.type.startsWith('image/')) return;
        const reader = new FileReader();
        reader.onload = (ev)=> saveImage(ev.target.result);
        reader.readAsDataURL(file);
      });
    }
    function saveImage(dataUrl){
      const arr = JSON.parse(localStorage.getItem(GALLERY_KEY) || '[]');
      arr.unshift({src:dataUrl, ts: Date.now()}); // Ø£Ø­Ø¯Ø« ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
      localStorage.setItem(GALLERY_KEY, JSON.stringify(arr));
      renderGallery();
    }

    if(imageUpload){
      imageUpload.addEventListener('change', (e)=> handleFiles(e.target.files));
    }
    if(dropZone){
      dropZone.addEventListener('dragover', (e)=>{ e.preventDefault(); dropZone.classList.add('dragover'); });
      dropZone.addEventListener('dragleave', ()=> dropZone.classList.remove('dragover'));
      dropZone.addEventListener('drop', (e)=>{
        e.preventDefault(); dropZone.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
      });
    }

    // ========= Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ø±Ø¶ =========
    function renderGallery(){
      const grid = document.getElementById('photoGrid');
      if(!grid) return;
      const arr = JSON.parse(localStorage.getItem(GALLERY_KEY) || '[]');
      grid.innerHTML = '';

      if(arr.length === 0){
        grid.innerHTML = `<div class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ø¨Ø¹Ø¯. ÙØ¹Ù‘Ù„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ø±ÙØ¹ ØµÙˆØ±.</div>`;
        return;
      }

      arr.forEach((item, idx)=>{
        const el = document.createElement('div');
        el.className = 'gallery-item';
        el.innerHTML = `
          <img class="gallery-img" src="${item.src}" alt="photo-${idx}">
          <div class="gallery-actions admin-only">
            <button class="btn btn-sm btn-danger" data-index="${idx}">Ø­Ø°Ù</button>
          </div>
        `;
        grid.appendChild(el);
      });

      // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù (ØªØ¸Ù‡Ø± ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø·)
      grid.querySelectorAll('.gallery-actions .btn-danger').forEach(btn=>{
        btn.addEventListener('click', function(){
          const i = +this.getAttribute('data-index');
          const arr = JSON.parse(localStorage.getItem(GALLERY_KEY) || '[]');
          arr.splice(i,1);
          localStorage.setItem(GALLERY_KEY, JSON.stringify(arr));
          renderGallery();
        });
      });
    }

    // ========= Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ù„Ø§Øº + Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ø¨Ù„/Ø¨Ø¹Ø¯ =========
    // ÙˆØ¸ÙŠÙØ© Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
    function addReportToGallery(data, prepend = true) {
      const gallery = document.getElementById('reportsGallery');
      if (!gallery) return;
      
      // ØªØ­ÙˆÙŠÙ„ ÙØ¦Ø© Ø§Ù„Ø¨Ù„Ø§Øº Ø¥Ù„Ù‰ Ø±Ù…Ø²
      let categoryIcon = 'ğŸ“‹';
      switch(data.category) {
        case 'lighting': categoryIcon = 'ğŸ’¡'; break;
        case 'pothole': categoryIcon = 'ğŸ•³ï¸'; break;
        case 'waste': categoryIcon = 'ğŸ—‘ï¸'; break;
        case 'water': categoryIcon = 'ğŸ’§'; break;
        case 'works': categoryIcon = 'ğŸš§'; break;
      }
      
      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø¥Ù„Ù‰ Ù„ÙˆÙ†
      let priorityColor = '#f59e0b'; // Ù…ØªÙˆØ³Ø·Ø©
      switch(data.priority) {
        case 'low': priorityColor = '#10b981'; break;
        case 'high': priorityColor = '#ef4444'; break;
        case 'urgent': priorityColor = '#7c3aed'; break;
      }
      
      // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
      const date = data.created_at ? new Date(data.created_at) : new Date();
      const formattedDate = `${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}`;
      
      // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù„Ø§Øº
      const status = data.status || 'new';
      let statusText = 'Ø¬Ø¯ÙŠØ¯Ø©';
      let statusColor = 'var(--primary)';
      
      if (status === 'in_progress') {
        statusText = 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©';
        statusColor = '#f59e0b';
      } else if (status === 'resolved') {
        statusText = 'ØªÙ… Ø§Ù„Ø­Ù„';
        statusColor = '#10b981';
      } else if (status === 'resolved_by_official') {
        statusText = 'ØªÙ… Ø§Ù„Ø­Ù„ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„';
        statusColor = '#059669';
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø¨Ù„Ø§Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯
      const reportCard = document.createElement('div');
      reportCard.className = 'report-card';
      reportCard.dataset.id = data.id || '';
      reportCard.style = 'background:var(--muted);border:1px solid var(--border);border-radius:12px;padding:16px;';
      
      // ØªØ­Ø¯ÙŠØ¯ Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
      let priorityText = 'Ù…ØªÙˆØ³Ø·Ø©';
      if (data.priority === 'low') priorityText = 'Ù…Ù†Ø®ÙØ¶Ø©';
      if (data.priority === 'high') priorityText = 'Ø¹Ø§Ù„ÙŠØ©';
      if (data.priority === 'urgent') priorityText = 'Ø¹Ø§Ø¬Ù„Ø©';
      
      reportCard.innerHTML = `
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div>
            <h4 class="mb-1" style="font-size:16px;">${data.title}</h4>
            <div style="display:flex;gap:8px;font-size:12px;color:var(--muted-foreground);">
              <span>${categoryIcon}</span><span>${data.district}</span><span>â€¢</span><span>Ø¨Ù„Ø¯ÙŠØ© ${data.commune}</span>
            </div>
          </div>
          <span class="badge" style="background:${priorityColor};">${priorityText}</span>
        </div>
        <p class="mb-2" style="color:var(--muted-foreground);">${data.description}</p>
        ${data.hasImages ? '<div class="mb-2"><small style="color:var(--primary);cursor:pointer;">ğŸ“· Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</small></div>' : ''}
        <div class="d-flex justify-content-between align-items-center" style="font-size:12px;">
          <span style="color:var(--muted-foreground);">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formattedDate}</span>
          <span class="badge" style="background:${statusColor};">${statusText}</span>
        </div>
      `;
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
      if (data.hasImages) {
        reportCard.style.cursor = 'pointer';
        reportCard.addEventListener('click', () => {
          showImageModal(data);
        });
      }
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø£Ùˆ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ø±Ø¶
      if (prepend) {
        gallery.insertBefore(reportCard, gallery.firstChild);
      } else {
        gallery.appendChild(reportCard);
      }
      
      return reportCard;
    }
    
    // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    
    // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
    async function loadReports() {
      try {
        console.log('Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
        
        // ØªÙØ±ÙŠØº Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
        const gallery = document.getElementById('reportsGallery');
        if (gallery) {
          gallery.innerHTML = '<div class="text-center p-4">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª...</div>';
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        const storedReports = window.reportsStorage.loadReports();
        console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${storedReports.length} Ø¨Ù„Ø§Øº Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ`);
        
        // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ù…Ø­ÙÙˆØ¸Ø©
        let allReports = [...storedReports];
        
        if (storedReports.length === 0) {
          console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
          
          // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
          const mockReports = [
            { 
              id: 'demo_1', 
              title: 'Ø¥ØµÙ„Ø§Ø­ Ø­ÙØ±Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 
              description: 'Ø­ÙØ±Ø© ÙƒØ¨ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØªØ³Ø¨Ø¨ Ø®Ø·Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙˆØ± ÙˆÙŠØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­ Ø¹Ø§Ø¬Ù„',
              district: 'Ø§Ù„Ø­ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
              commune: 'Ø§Ù„Ø­Ø§Ù…Ø©',
              category: 'pothole',
              priority: 'high',
              status: 'new',
              created_at: '2024-01-15T10:30:00Z'
            },
            { 
              id: 'demo_2', 
              title: 'Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„Ø¥Ù†Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©', 
              description: 'Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ù†Ø§Ø±Ø© Ù„Ø§ ÙŠØ¹Ù…Ù„ Ù…Ù†Ø° Ø£Ø³Ø¨ÙˆØ¹ Ù…Ù…Ø§ ÙŠØ³Ø¨Ø¨ Ø¸Ù„Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©',
              district: 'Ø­ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
              commune: 'Ø¨Ø§Ø¨Ø§Ø±',
              category: 'lighting',
              priority: 'medium',
              status: 'in_progress',
              created_at: '2024-01-14T08:15:00Z'
            },
            { 
              id: 'demo_3', 
              title: 'ØªØ³Ø±Ø¨ Ù…ÙŠØ§Ù‡ ÙÙŠ Ø§Ù„Ø´Ø§Ø±Ø¹', 
              description: 'ØªØ³Ø±Ø¨ Ù…ÙŠØ§Ù‡ ÙƒØ¨ÙŠØ± ÙÙŠ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ ÙŠØ³Ø¨Ø¨ ØªØ¬Ù…Ø¹ Ø§Ù„Ù…ÙŠØ§Ù‡',
              district: 'ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
              commune: 'Ø®Ù†Ø´Ù„Ø©',
              category: 'water',
              priority: 'urgent',
              status: 'resolved',
              created_at: '2024-01-10T14:20:00Z'
            }
          ];
          
          allReports = mockReports;
        }
        
        // ØªÙØ±ÙŠØº Ø§Ù„Ù…Ø¹Ø±Ø¶ Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
        if (gallery) {
          gallery.innerHTML = '';
        }
        
        console.log(`ØªÙ… ØªØ­Ø¶ÙŠØ± ${allReports.length} Ø¨Ù„Ø§Øº Ù„Ù„Ø¹Ø±Ø¶`);
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø±Ø¶
        if (allReports.length > 0) {
          allReports.forEach(report => {
            addReportToGallery(report, false);
          });
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
          updateStats(allReports);
          
          console.log('ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
        } else {
          console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§');
          if (gallery) {
            gallery.innerHTML = '<div class="text-center p-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª</div>';
          }
        }
      } catch (err) {
        console.error('Error in loadReports:', err);
        const gallery = document.getElementById('reportsGallery');
        if (gallery) {
          gallery.innerHTML = `<div class="text-center p-4 text-danger">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª: ${err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>`;
        }
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function updateStats(reports) {
      if (!reports) return;
      
      const totalReports = reports.length;
      const newReports = reports.filter(r => r.status === 'new').length;
      const inProgressReports = reports.filter(r => r.status === 'in_progress').length;
      const resolvedReports = reports.filter(r => r.status === 'resolved').length;
      
      document.getElementById('total-reports').textContent = totalReports;
      document.getElementById('new-reports').textContent = newReports;
      document.getElementById('in-progress-reports').textContent = inProgressReports;
      document.getElementById('resolved-reports').textContent = resolvedReports;
      
      console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', { totalReports, newReports, inProgressReports, resolvedReports });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯
    function updateStatsAfterNewReport() {
      const totalElement = document.getElementById('total-reports');
      const newElement = document.getElementById('new-reports');
      
      if (totalElement) {
        const currentTotal = parseInt(totalElement.textContent) || 0;
        totalElement.textContent = currentTotal + 1;
      }
      
      if (newElement) {
        const currentNew = parseInt(newElement.textContent) || 0;
        newElement.textContent = currentNew + 1;
      }
      
      console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯');
    }
    
    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø¨Ù„Ø§Øº
    function updateStatsAfterFailedReport() {
      const totalElement = document.getElementById('total-reports');
      const newElement = document.getElementById('new-reports');
      
      if (totalElement) {
        const currentTotal = parseInt(totalElement.textContent) || 0;
        totalElement.textContent = Math.max(0, currentTotal - 1);
      }
      
      if (newElement) {
        const currentNew = parseInt(newElement.textContent) || 0;
        newElement.textContent = Math.max(0, currentNew - 1);
      }
      
      console.log('ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§Øº');
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
      try {
        console.log('ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© - Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        loadReports();
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª:', err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
      }
    });
    
    const reportForm = document.getElementById('reportForm');
    if (reportForm){
      reportForm.addEventListener('submit', async function(e){
        e.preventDefault();
        
        // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        }
        
        try {
          // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
          const beforeImageFile = document.getElementById('before').files[0];
          const afterImageFile = document.getElementById('after').files[0];
          
          let beforeImageData = null;
          let afterImageData = null;
          
          // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Base64 Ù„Ù„Ø­ÙØ¸
          if (beforeImageFile) {
            beforeImageData = await fileToBase64(beforeImageFile);
          }
          if (afterImageFile) {
            afterImageData = await fileToBase64(afterImageFile);
          }
          
          // ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          const data = {
            id: 'temp_' + Date.now(), // Ù…Ø¹Ø±Ù Ù…Ø¤Ù‚Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            district: document.getElementById('district').value,
            commune: document.getElementById('commune').value,
            category: document.getElementById('category').value,
            priority: (document.getElementById('priority')||{value:'medium'}).value,
            internalNote: (document.getElementById('internalNote')||{value:''}).value,
            status: 'new',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
            created_by: localStorage.getItem('userId') || null,
            beforeImage: beforeImageData,
            afterImage: afterImageData,
            hasImages: !!(beforeImageData || afterImageData)
          };
          
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§Øº ÙÙˆØ±Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø±Ø¶ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ±ÙŠ
          console.log('Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§Øº Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø±Ø¶ ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠØ§Ù‹:', data);
          const reportCard = addReportToGallery(data, true); // true Ù„Ù„Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
          
          // Ø­ÙØ¸ Ø§Ù„Ø¨Ù„Ø§Øº ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
          const saved = window.reportsStorage.addReport(data);
          if (saved) {
            console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ù„Ø§Øº ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
          } else {
            console.warn('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨Ù„Ø§Øº ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
          }
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙˆØ±Ø§Ù‹
          updateStatsAfterNewReport();
          
          console.log('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§Øº ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ù†Ø¬Ø§Ø­');
          alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø§Øº ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØ¸Ù‡Ø± Ø­ØªÙ‰ Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
          
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          this.reset();
          const pb=document.getElementById('prev-before'); if(pb) pb.innerHTML='';
          const pa=document.getElementById('prev-after'); if(pa) pa.innerHTML='';
        } catch (err) {
          console.error('Error in form submission:', err);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        } finally {
          // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
          if (submitButton) {
            submitButton.disabled = false;
            submitButton.innerHTML = 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº';
          }
        }
      });

      const beforeInput=document.getElementById('before');
      const afterInput=document.getElementById('after');
      if(beforeInput) beforeInput.addEventListener('change', (e)=> previewImage(e.target,'prev-before'));
      if(afterInput)  afterInput.addEventListener('change', (e)=> previewImage(e.target,'prev-after'));

      function previewImage(input, previewId){
        const holder=document.getElementById(previewId);
        if(!holder) return; holder.innerHTML='';
        if(input.files && input.files[0]){
          const reader=new FileReader();
          reader.onload=(ev)=>{
            const img=new Image();
            img.src=ev.target.result; img.style.maxWidth='100%'; img.style.borderRadius='8px';
            holder.appendChild(img);
          };
          reader.readAsDataURL(input.files[0]);
        }
      }
    }
    
    // Admin Messages Ticker Management
    let adminMessages = [
      'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯',
      'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø£ÙŠ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©',
      'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡',
      'Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§ÙˆÙ†ÙƒÙ… ÙÙŠ ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'
    ];
    
    function updateAdminTicker() {
      const tickerContent = document.querySelector('.ticker-content');
      if (tickerContent && adminMessages.length > 0) {
        tickerContent.innerHTML = adminMessages.map(msg => 
          `<span class="ticker-item">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: ${msg}</span>`
        ).join('');
      }
    }
    
    function addAdminMessage(message) {
      if (message && message.trim()) {
        adminMessages.unshift(message.trim());
        if (adminMessages.length > 10) {
          adminMessages = adminMessages.slice(0, 10); // Keep only last 10 messages
        }
        updateAdminTicker();
      }
    }
    
    // Initialize ticker on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateAdminTicker();
    });
    
    // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ù„Ø§Øº ÙƒÙ…Ø­Ù„ÙˆÙ„ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
    function markAsResolvedByOfficial(reportId, event) {
      // Ù…Ù†Ø¹ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø­Ø¯Ø« Ù„ØªØ¬Ù†Ø¨ ØªÙØ¹ÙŠÙ„ Ø£Ø­Ø¯Ø§Ø« Ø£Ø®Ø±Ù‰
      if (event) {
        event.stopPropagation();
      }
      
      if (!reportId) {
        alert('Ø®Ø·Ø£: Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ù„Ø§Øº ØºÙŠØ± ØµØ­ÙŠØ­');
        return;
      }
      
      // ØªØ£ÙƒÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø§Øº ØªÙ… Ø­Ù„Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ØŸ')) {
        return;
      }
      
      try {
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù„Ø§Øº ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†
        const updatedData = {
          status: 'resolved_by_official',
          resolved_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        };
        
        const success = window.reportsStorage.updateReport(reportId, updatedData);
        
        if (success) {
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ø¯ÙŠØ«
          loadReports();
          
          // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
          alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù„Ø§Øº Ø¥Ù„Ù‰ "ØªÙ… Ø§Ù„Ø­Ù„ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" Ø¨Ù†Ø¬Ø§Ø­!');
          
          console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù„Ø§Øº Ø¨Ù†Ø¬Ø§Ø­:', reportId);
        } else {
          alert('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù„Ø§Øº. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
          console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù„Ø§Øº:', reportId);
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù„Ø§Øº:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù„Ø§Øº. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
      }
    }

    // ÙˆØ¸ÙŠÙØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    function showImageModal(reportData) {
      const modal = document.getElementById('imageModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalImages = document.getElementById('modalImages');
      
      modalTitle.textContent = reportData.title;
      modalImages.innerHTML = '';
      
      // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø´ØºØ§Ù„
      if (reportData.beforeImage) {
        const beforeDiv = document.createElement('div');
        beforeDiv.innerHTML = `
          <h5 style="margin-bottom:10px;">ğŸ“· ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø´ØºØ§Ù„</h5>
          <img src="${reportData.beforeImage}" style="width:100%;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" alt="ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø´ØºØ§Ù„">
        `;
        modalImages.appendChild(beforeDiv);
      }
      
      // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø´ØºØ§Ù„
      if (reportData.afterImage) {
        const afterDiv = document.createElement('div');
        afterDiv.innerHTML = `
          <h5 style="margin-bottom:10px;">ğŸ“· ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø´ØºØ§Ù„</h5>
          <img src="${reportData.afterImage}" style="width:100%;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" alt="ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø´ØºØ§Ù„">
        `;
        modalImages.appendChild(afterDiv);
      }
      
      modal.style.display = 'block';
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('imageModal');
      const closeBtn = modal.querySelector('.close');
      
      closeBtn.onclick = function() {
        modal.style.display = 'none';
      }
      
      window.onclick = function(event) {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      }
    });

    // ØªÙ…Ø±ÙŠØ± Ù†Ø§Ø¹Ù… Ù„Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', function(e){
        const id = this.getAttribute('href');
        if(id && id.startsWith('#') && id.length>1){
          e.preventDefault();
          document.querySelector(id).scrollIntoView({behavior:'smooth'});
        }
      });
    });
  </script>
</body>
</html>
